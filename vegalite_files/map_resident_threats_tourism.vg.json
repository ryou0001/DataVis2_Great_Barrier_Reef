{
"$schema": "https://vega.github.io/schema/vega-lite/v5.json",
"data": {"url": "vegalite_files/data/resident_threatsx.csv"},
"padding": 0,

        "width": 358,
        "height": 360,
        "title": { "text": ["Total tourist numbers in 2017 and","Residents' attitudes to tourism"], "fontSize": 14 },
        "projection": {"type": "azimuthalEqualArea", "rotate":[-141, 14], "scale": 1020, "center": [6.2,-5.6]},
        "view": {"fill": "white"},
        "layer": [
            {
            "data": {
                "name": "GBR_boundary",
                "url": "vegalite_files/maps/GBR_management_areas.json",
                "format": {"type": "topojson", "feature": "Great_Barrier_Reef_Marine_Park_Management_Areas_20_8519682087340233118"}
            },
            "transform": [
                {
                    "lookup": "properties.AREA_DESCR",
                    "from": {
                        "data": {"url": "vegalite_files/data/tourist_numbers_2017.csv"},
                        "key": "MA",
                        "fields": ["Management_Area", "visits"]                    }
                }
            ],
            "mark": {"type": "geoshape", "opacity": 0.5, "stroke": "black"},
            "encoding": {
                "color": {"field": "Management_Area", "scale": {"scheme": "dark2"}, "legend": {"title": "Management Area"}},
                "tooltip": [
                    {"field": "Management_Area", "title": "Management Area"},
                    {"field": "visits", "format": ",", "title": "Total tourists in 2017"}
                ]
            }
            },
            {
                "data": {
                    "url": "vegalite_files/maps/queensland_surrounds.json",
                    "format": {"type": "topojson", "feature": "STE_2021_AUST_GDA2020"}
                },
                "mark": {"type": "geoshape", "fill": "lightgray", "stroke": "darkgray"}
            },
            {
                "data": {
                    "url": "vegalite_files/maps/queensland.json",
                    "format": {"type": "topojson", "feature": "ne_10m_admin_1_states_provinces"}
                },
                "mark": {"type": "geoshape", "fill": "white", "stroke": "darkgray"}
            },
            {
                "data": {
                    "url": "vegalite_files/maps/NRM_regions_2020.json",
                    "format": {"type": "topojson", "feature": "NRM_regions_2020"}
                },
                "transform": [
                {
                    "calculate": "datum.properties.NRM_REGION+'4'", "as": "combined_key"    
                },{
                    "lookup": "combined_key",
                    "from": {
                        "data": {"url": "vegalite_files/data/resident_threatsx.csv"},
                        "key": "NRM_key",
                        "fields": ["NRM", "population", "total_interviewed", "threat", "threat_total"]
                    }
                },{
                    "calculate": "datum.threat_total/datum.total_interviewed",
                    "as": "threat_perc"
                },{
                    "calculate": "datum.total_interviewed < 10 ? 'Insufficient data' : format(datum.threat_perc, '.2%')",
                    "as": "tooltip_threat_perc"
                },{
                    "calculate": "datum.total_interviewed < 10 ? 'Insufficient data' : datum.threat_total",
                    "as": "tooltip_threat_total"
                }],
                "mark": {
                    "type": "geoshape", 
                    "stroke": "darkgray",
                    "opacity": 0.6
                },
                "encoding": {
                    "opacity": {
                    },
                    "color": {
                        "condition": {
                            "test": "datum.threat_perc == 0",
                            "value": "lightgrey"
                        },
                        "field": "threat_perc",
                        "type": "quantitative",
                        "scale": {
                            "domain": [0,0.25], "scheme": {"name": "greens"}
                        },
                    "legend": {
                        "title": ["% of residents who", "identified tourism as", "a threat"],
                        "format": ".0%"
                    }
                    },
                    "tooltip": [
                        {"field": "properties.NRM_REGION", "type": "nominal", "title": "NRM Region"},
                        {"field": "tooltip_threat_total", "title": "Num. interviewed residents concerned about threat"},
                        {"field": "tooltip_threat_perc", "title": "Perc. interviewed residents concerned about threat"}
                    ]
                }
            },{
            "data": {"values": {"state": "QUEENSLAND", "x": 146, "y": -27.5}},
            "mark": {"type": "text", "fontSize": 20, "color": "darkgray"},
            "encoding": {
                "text": {"field": "state", "type": "nominal"},
                "longitude": {"field": "x"}, 
                "latitude": {"field": "y"}}
            },
            {
            "data": {
                "url": "vegalite_files/maps/ne_10m_graticules_5.json",
                "format": {"type": "topojson", "feature": "ne_10m_graticules_5"}
            },
            "mark": {"type": "geoshape", "stroke": "darkgrey", "fill": null, "opacity": 0.3}
            },{
            "data": {"values":[
              {"longitude": 144, "latitude": -18.2, "label": ["WET TROPICS", "Highest: 19.58%"]},
              {"longitude": 146, "latitude": -24.6, "label": ["FITZROY", "Lowest: 4.51%"]}
            ]},
            "mark": {"type": "text", "align": "right", "fontSize": 13},
            "encoding": {
              "text": {"field": "label"},
              "longitude": {"field": "longitude"},
              "latitude": {"field": "latitude"}
            }
            },{
            "data": {"values":[
              {"longitude1": 145.6, "latitude1": -17.4, "longitude2": 144, "latitude2": -18.2},
              {"longitude1": 149.2, "latitude1": -23.7, "longitude2": 146, "latitude2": -24.6}
            ]},
            "mark": {"type": "line", "opacity": 0.3, "color":"black"},
            "encoding": {
                "longitude": {"field": "longitude1"},
                "latitude": {"field": "latitude1"},
                "longitude2": {"field": "longitude2"},
                "latitude2": {"field": "latitude2"}
            }
            },{
            "data": {"values": [
                {"name": "Cairns",	"longitude": 145.7, "latitude":	-16.9},
                {"name":"Port Douglas",	"longitude": 145.4, "latitude":	-16.4},
                {"name": "Whitsunday", "longitude": 148.7, "latitude": -20.2}
            ]},
            "mark": {"type": "circle", "opacity": 1, "color": "black", "size": 10},
            "encoding": {
                "latitude": {"field": "latitude"},
                "longitude": {"field": "longitude"}
            }
            },
            {
            "data": {"values": [
                {"name": "Cairns",	"longitude": 145.7, "latitude":	-16.9},
                {"name":"Port Douglas",	"longitude": 145.4, "latitude":	-16.4},
                {"name": "Whitsunday", "longitude": 148.7, "latitude": -20.2}
            ]},
            "mark": {"type": "text", "opacity": 1, "color": "black", "fontSize": 10, "align": "right", "dx": -5},
            "encoding": {
                "text": {"field": "name"},
                "latitude": {"field": "latitude"},
                "longitude": {"field": "longitude"}
            }
            },{
            "data": {
                "values": [
                {"x": 150.8, "y": -18.3, "img": "vegalite_files/data/people_99.png", "MA": "Townsville/Whitsunday", "visits": "999554"}
                ]
            },
            "mark": {"type": "image", "width": 90, "height": 90},
            "encoding": {
                "longitude": {"field": "x", "type": "quantitative"},
                "latitude": {"field": "y", "type": "quantitative"},
                "url": {"field": "img", "type": "nominal"},
                                "tooltip": [
                    {"field": "MA", "title": "Management Area"},
                    {"field": "visits", "format": ",", "title": "Total tourists in 2017"}
                ]

            }
            },{
            "data": {
                "values": [
                {"x": 144.5, "y": -12.5, "img": "vegalite_files/data/people_0.6.png", "MA": "Far Northern", "visits": "6217"}
                ]
            },
            "mark": {"type": "image", "width": 10, "height": 20},
            "encoding": {
                "longitude": {"field": "x", "type": "quantitative"},
                "latitude": {"field": "y", "type": "quantitative"},
                "url": {"field": "img", "type": "nominal"},
                                "tooltip": [
                    {"field": "MA", "title": "Management Area"},
                    {"field": "visits", "format": ",", "title": "Total tourists in 2017"}
                ]

            }
            },{
            "data": {
                "values": [
                {"x": 152.5, "y": -22.4, "img": "vegalite_files/data/people_19.png", "MA": "Mackay/Capricorn", "visits": "191785"}
                ]
            },
            "mark": {"type": "image", "width": 35, "height": 35},
            "encoding": {
                "longitude": {"field": "x", "type": "quantitative"},
                "latitude": {"field": "y", "type": "quantitative"},
                "url": {"field": "img", "type": "nominal"},
                "tooltip": [
                    {"field": "MA", "title": "Management Area"},
                    {"field": "visits", "format": ",", "title": "Total tourists in 2017"}
                ]
            }
            },{
            "data": {
                "values": [
                {"x": 149, "y": -15, "img": "vegalite_files/data/people_139.png", "MA": "Cairns/Cooktown", "visits": "1397565"}
                ]
            },
            "mark": {"type": "image", "width": 100, "height": 100},
            "encoding": {
                "longitude": {"field": "x", "type": "quantitative"},
                "latitude": {"field": "y", "type": "quantitative"},
                "url": {"field": "img", "type": "nominal"},
                "tooltip": [
                    {"field": "MA", "title": "Management Area"},
                    {"field": "visits", "format": ",", "title": "Total tourists in 2017"}
                ]
            }
            },{
            "data": {
                "values": [
                {"x": 152.5, "y": -11, "img": "vegalite_files/data/person.png"}
                ]
            },
            "mark": {"type": "image", "width": 30, "height": 30},
            "encoding": {
                "longitude": {"field": "x", "type": "quantitative"},
                "latitude": {"field": "y", "type": "quantitative"},
                "url": {"field": "img", "type": "nominal"}
            }
            },{
            "data": {"values": {"label": "10,000 tourists", "x": 153, "y": -11}},
            "mark": {"type": "text", "fontSize": 12, "color": "black", "align": "left"},
            "encoding": {
                "text": {"field": "label", "type": "nominal"},
                "longitude": {"field": "x"}, 
                "latitude": {"field": "y"}}
            }
        ]
    }