{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "config": {"view": {"stroke": "transparent"}},
      "padding": 0,
   "width": 624,
  "height": 200,
  "title": {"text": "Percentage of jobs in mining", "fontSize": 14},
  "data": {"url": "vegalite_files/data/mining_num_jobs.csv"},
  "transform": [{
      "filter": "datum.NRM != 'Australia' && datum.NRM != 'Queensland'"
    },
    {
      "calculate": "datum.mining_count / datum.total_count", "as": "mining_perc"
    },{
      "calculate": "datum.mining_count * 1000", "as": "job_count"
    }
      ],
  "layer": [{
    "mark": {"type": "bar", "size": 20, "opacity": 0.4},
    "encoding": {
          "y": {"field": "NRM", "type": "nominal", "sort": ["Cape York", "Wet Tropics", "Burdekin", "Mackay Whitsunday", "Fitzroy", "Burnett Mary"], "axis": {"labelFontSize": 12}, "title": null},
          "x": {"field": "mining_perc", "type": "quantitative", "axis": {"grid": false, "format": ".0%"}, "title": "Percentage of jobs in mining"},
          "color": {
            "condition": {
              "test": {"field": "NRM", "equal": "Total GBR"},
              "value": "blue"
            }, "value": "black"
          },
					"tooltip": [
						{"field": "NRM", "title": "NRM Region"},
						{"field": "job_count", "format": ",", "title": "Total mining jobs"},
            {"field": "mining_perc", "format": ".2%", "title": "Percentage jobs in mining"}
					]
        }
  	},{
			"mark": "rule",
			"encoding": {
				"x": {"datum": 0.0163}
			}
		},{
        "mark": {"type": "bar", "size": 20},
        "transform": [
          {"filter": "datum.mining_perc >= 0.0163"},
          {"calculate": "0.0163", "as": "baseline"}
        ],
        "encoding": {
          "y": {"field": "NRM", "type": "nominal", "sort": ["Cape York", "Wet Tropics", "Burdekin", "Mackay Whitsunday", "Fitzroy", "Burnett Mary"], "axis": {"labelFontSize": 12}, "title": null},
          "x": {"field": "baseline", "type": "quantitative"},
          "x2": {"field": "mining_perc"},
          "color": {
            "condition": {
              "test": {"field": "NRM", "equal": "Total GBR"},
              "value": "blue"
            }, "value": "black"
            },
          "tooltip": [
						{"field": "NRM", "title": "NRM Region"},
						{"field": "job_count", "format": ",", "title": "Total mining jobs"},
            {"field": "mining_perc", "format": ".2%", "title": "Percentage jobs in mining"}
					]

        }
    },{
      "data": {"values": [
        {"label": ["Very high percentage of mining jobs", "Low real number of mining jobs"]}
      ]},
      "mark": {
        "type": "text", 
        "align": "right", 
        "baseline": "middle",
        "dx": 280,
        "dy": -65
      },
      "encoding": {
        "text": {"field": "label"}
      }
    },{
      "data": {"values": [
        {"label": ["High number and percentage of mining jobs","Low rate of concern about mining"]}
      ]},
      "mark": {
        "type": "text", 
        "align": "left", 
        "baseline": "middle",
        "dx": 100,
        "dy": 25
      },
      "encoding": {
        "text": {"field": "label"}
      }
    },{
      "data": {"values": [
        {"label": ["Low percentage of mining jobs","High rate of concern about mining"]}
      ]},
      "mark": {
        "type": "text", 
        "align": "left", 
        "baseline": "middle",
        "dx": -200,
        "dy": 50
      },
      "encoding": {
        "text": {"field": "label"}
      }
    },
    {
      "data": {"values": [
        {"label": ["Percentage jobs in mining in Australia"]}
      ]},
      "mark": {
        "type": "text", 
        "align": "center", 
        "baseline": "middle",
        "dx": 0,
        "dy": -250,
        "angle": -90
      },
      "encoding": {
        "text": {"field": "label"}
      }
    }
  ]
}