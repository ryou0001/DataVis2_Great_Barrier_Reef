{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "config": {"view": {"stroke": "transparent"}},
    "hconcat": [
    {
  "width": 300,
  "height": 200,
  "title": {"text": "Total jobs and population in 2017", "fontSize": 14},
  "encoding": {
        "y": {
          "field": "NRM", 
          "type": "nominal", 
          "sort": ["Cape York", "Wet Tropics", "Burdekin", "Mackay Whitsunday", "Fitzroy", "Burnett Mary"], 
          "title": null,
          "axis": {"labelFontSize": 12}
        }
        },
  "layer": [
    {
      "data": {
        "url": "vegalite_files/data/residents.csv"
      },
      "mark": {"type": "bar", "color": "#002857", "opacity": 0.7},
      "encoding": {
        "x": {"field": "population", "type": "quantitative", "scale": {"domain": [0,360000]}, "axis": {"tickCount": 4, "title": "Count"}},
        "tooltip": [
          {"field": "NRM", "title": "NRM Region"},
          {"field": "population", "title": "Population", "format": ","}
        ]
      }
    },{
    "data": {
        "url": "vegalite_files/data/num_jobs.csv"
    },
      "params": [{
      "name": "job_bar", "select":  {
        "type": "point", 
        "fields": ["NRM", "job"]}, 
        "value": [{"NRM": null, "job": null}] 
    }],
    "transform": [{
      "filter": "datum.NRM != 'Australia' && datum.NRM != 'Queensland'"
    },{
      "calculate": "datum.count * 1000", "as": "job_count"
    },{
			"calculate": "job_bar.job == datum.job ? 0 : (datum.job == 'Other' ? 2 : 1)", "as": "job_order"
			},{
        "joinaggregate": [{"op": "sum", "field": "job_count", "as": "total_job_count"}], "groupby": ["NRM"]
      }

      ],
    "mark": {"type": "bar", "size": 20, "color": "#00aeef"},
    "encoding": {
          "x": {"field": "job_count", "type": "quantitative", "scale": {"domain": [0,360000]}, "axis": null},
          "color": {"condition": {"test": "job_bar.job == datum.job", "value": "#002857"}, "value": "#00aeef"},
					"order": {"field": "job_order"},
          "tooltip": [
            {"field": "NRM", "title": "NRM Region"},
            {"field": "total_job_count", "title": "Total number of jobs", "format": ","}
          ]
        }
    },{
      "data": {"values": [
        {"label": ["Jobs"]}
      ]},
      "mark": {
        "type": "text", 
        "align": "center", 
        "baseline": "middle",
        "dx": -50,
        "dy": 83,
        "color": "black",
        "fontSize": 14
      },
      "encoding": {
        "text": {"field": "label"},
        "y": {"sort": ["Cape York", "Wet Tropics", "Burdekin", "Mackay Whitsunday", "Fitzroy", "Burnett Mary"], 
          "title": null}
      }
    },{
      "data": {"values": [
        {"label": ["Population"]}
      ]},
      "mark": {
        "type": "text", 
        "align": "center", 
        "baseline": "middle",
        "dx": 20,
        "dy": 83,
        "color": "white",
        "fontSize": 14
      },
      "encoding": {
        "text": {"field": "label"},
        "y": {"sort": ["Cape York", "Wet Tropics", "Burdekin", "Mackay Whitsunday", "Fitzroy", "Burnett Mary"], 
          "title": null}
      }
    }
  ]
    },
    {
  "width": 530,
  "height": 200,
  "padding": 0,
  "title": {"text": "Job percentages by type in 2017", "fontSize": 14},
  "layer": [{
    "data": {
        "url": "vegalite_files/data/num_jobs.csv"
    },
    "params": [{
      "name": "job_bar", "select":  {
        "type": "point", 
        "fields": ["NRM", "job"]}
    }],
    "transform": [{
      "filter": "datum.NRM != 'Australia' && datum.NRM != 'Queensland'"
    },{
      "calculate": "datum.count * 1000", "as": "job_count"
    },{
			"calculate": "job_bar.job == datum.job ? 0 : (datum.job == 'Other' ? 2 : 1)", "as": "job_order"
			}
  ],
    "mark": {"type": "bar", "size": 20},
    "encoding": {
          "y": {"field": "NRM", "type": "nominal", "axis": null, "sort": ["Cape York", "Wet Tropics", "Burdekin", "Mackay Whitsunday", "Fitzroy", "Burnett Mary"]},
          "x": {"field": "percent", "type": "quantitative", "title": "Count", "axis": {"grid": false, "format": ".0%"}, "scale": {"domain": [0,1]}},
          "color": {
            "field": "job",
            "scale": {"scheme": "dark2"},
            "legend": {"direction": "horizontal", "orient": "bottom", "labelLimit": 200, "title": "Job types", "labelFontSize": 12}
          },
					"opacity": {
						"condition": {
							"test": "job_bar == null || job_bar.job == datum.job",
							"value": 1
						}, "value": 0.4
					},
					"order": {"field": "job_order"},
					"tooltip": [
						{"field": "NRM", "title": "NRM Region"},
						{"field": "job", "title": "Job type"},
						{"field": "job_count", "format": ",", "title": "Count"},
            {"field": "percent", "format": ".2%", "title": "Percentage of region's jobs"}
					]
        }
  	},{
		"mark": {"type":"rule", "strokeWidth":10, "color": "black"},
		"encoding": {
			"x": {"datum": 100}
		}
		}  ]
    }
  ]
}