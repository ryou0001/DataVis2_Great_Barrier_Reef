{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "A bar chart visualization depicting words that GBR residents associate with the GBR.",
  "width": 500,
  "height": 300,
  "padding": 0,
  "config": {"font": "Arial"},
  "title": {"text": "Words residents use to describe the Great Barrier Reef", "fontSize": 14},
  "data": {
      "url": "vegalite_files/data/resident_words.csv"
  },
  "params": [
    {
      "name": "NRM_selection",
      "bind": {
        "input": "select",
        "options": [
          null,
          "Burdekin", 
          "Burnett Mary",
          "Fitzroy",
          "Mackay Whitsunday",
          "Wet Tropics"
        ],
        "labels": [
          "Show all",
          "Burdekin", 
          "Burnett Mary",
          "Fitzroy",
          "Mackay Whitsunday",
          "Wet Tropics"
        ],
        "name": "NRM selection: "
      }
    }
  ],
  "transform": [
    {"filter": "NRM_selection == null || datum.NRM == NRM_selection"},
    {
      "aggregate": [{
        "op": "sum",
        "field": "count",
        "as": "word_count"
      }],
      "groupby": ["words"]
    },{
      "window": [{"op": "rank", "as": "rank"}],
      "sort": [{"field": "word_count", "order": "descending"}]
    },{
      "filter": "datum.rank <=10 && datum.word_count > 3"
    }
  ],
  "encoding": {
        "x": {"field": "word_count", "type": "quantitative", "stack": null},
        "y": {"field": "words", "type": "nominal", "sort": "-x", "title": null, "axis": {"labelFontSize": 12}}
      },
  "layer": [
    {  
      "mark": "bar",
      "encoding": {
        "color": {
          "condition": [
            {
              "test": {"field": "words", "equal": "BLEACHING"},
              "value": "red"
            }, {
              "test": {"field": "words", "equal": "DYING"},
              "value": "red"
            }, 
            {
              "test": {"field": "words", "equal": "ENDANGERED"},
              "value": "red"
            }, 
            {
              "test": {"field": "words", "equal": "TOURISM"},
              "value": "green"
            },
            {
              "test": {"field": "words", "equal": "BEAUTIFUL"},
              "value": "palevioletred"
            },
            {
              "test": {"field": "words", "equal": "BEAUTY"},
              "value": "palevioletred"
            },
            {
              "test": {"field": "words", "equal": "CORAL"},
              "value": "goldenrod"
            },
            {
              "test": {"field": "words", "equal": "FISH"},
              "value": "goldenrod"
            }
        ], "value": "darkgrey"
        }
      }
    }, {
      "mark": {
        "type": "text",
        "align": "right",
        "baseline": "middle",
        "dx": -4,
        "color": "white"
      },
      "encoding": {
        "text": {"field": "word_count", "type": "quantitative"}
      }
    }
  ]
}